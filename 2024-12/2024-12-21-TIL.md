#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      2024-12-21-TIL

# 동기화 기법 - 2️⃣

## 세마포

- 뮤텍스 락은 하나의 공유 자원을 공유하는 동기화 도구임. 하지만, 공유 자원이 늘 하나만 있는 것은 아님. 한 번에 하나의 프로세스 및 스레드만 공유 자원을 이용할 수 있는 상황도 있지만, 한 번에 3개, 4개의 프로세스 및 스레드까지 특정 자원을 이용할 수 있는 상황도 있기 때문. 전자의 상황에는 뮤텍스 락을 이용할 수 있고, 후자의 상황에는 세마포를 이용할 수 있음.
- 세마포(semaphore)는 뮤텍스 락과 비슷하지만, 조금 더 일반화된 방식의 동기화 도구임. 세마포를 이용하면 공유 자원이 여러 개 있는 상황에서도 동기화가 가능.
- 세마포는 철도 신호기에서 유래한 단어임. 기차는 신호기가 내려가 있을 때를 멈추라는 신호로 간주해 잠시 멈추고, 반대로 신호기가 올라가 있을 때를 가도 좋다는 신호로 간주해 다시 움직임. 세마포는 이처럼 '멈춤' 신호와 '가도 좋다'는 신호로 임계 구역을 관리함. 즉, 프로세스 및 스레드가 임계 구역 앞에서 멈추라는 신호를 받으면 잠시 기다리고, 가도 좋다는 신호를 받으면 그제서야 임계 구역에 들어가게 됨.
- 세마포는 뮤텍스 락과 비슷하게 다음과 같은 하나의 변수와 2개의 함수로 구성됨.
  - 변수 S: 사용 가능한 공유 자원의 개수를 나타내는 변수
  - wait() 함수: 임계 구역 진입 전 호출하는 함수
  - signal() 함수: 임계 구역 진입 후 호출하는 함수
- 이 때, '사용 가능한 공유 자원의 개수'는 '임계 구역에 진입할 수 있는 프로세스 개수'와 같음. 공유 자원 개수가 S개일 경우, 임계 구역에 진입하여 동시에 실행 가능한 프로세스 혹은 스레드로 S개임. 그리고 뮤텍스 락을 이용할 때 임계 구역 진입 전후로 acquire()과 release() 함수를 호출했듯, 세마포도 임계 구역 전후로 wait(), signal() 함수임. wait() 함수가 내부적으로 어떻게 구현되는지부터 대략적으로 파악해보겠음.

<img width="594" alt="image" src="https://github.com/user-attachments/assets/64ee27a7-cddf-49b7-8c8d-5d14e3a52c98">

(그림출처: 이것이 취업을 위한 컴퓨터 과학이다)

- wait()는 함수 호출 시 가장 먼저 '사용 가능한 공유 자원의 개수'를 나타내는 변수 S를 1 감소시키고, 변수 S의 값이 0보다 작은지 여부를 확인함. S를 1 감소시켰을 때 S가 0 이상이라는 것은 사용 가능한 공유 자원의 개수가 남아 있었음을 의미함. 이 경우, wait()를 호출한 프로세스 및 스레드는 임계 구역에 진입함.  반대로, S를 1 감소시켰을 때 S가 0 미만이라는 것은 사용 가능한 공유 자원의 개수가 남아 있지 않았음을 의미함. 따라서, 변수 S의 값이 0보다 작으면 wait()를 호출한 프로세스 및 스레드는 대기 상태로 전환되어 임계 구역에 진입할 수 없게 됨

<img width="605" alt="image" src="https://github.com/user-attachments/assets/a180cdcc-fafe-456c-8a1f-05ad583ef1f1">

(그림출처: 이것이 취업을 위한 컴퓨터 과학이다)

- signal() 함수는 임계 구역에서의 작업이 끝난 프로세스 및 스레드가 호출함. signal()의 대략적인 구현 원리는 다음과 같음. signal()은 함수 호출 시 가장 먼저 '사용 가능한 공유 자원의 개수'를 나타내는 변수 S를 1 증가시키고, 변수 S의 값이 0이하인지를 확인함. S를 증가시켰을 때 S가 0보다 크다는 것은 사용 가능한 공유 자원의 개수가 1개 이상 남아 있음을 의미하며, 반대로 S를 1 증가 시켰을 때 0 이하라는 것은 임계 구역에 진입하기 위해 대기하는 프로세스가 존재함을 의미. 이 경우, 대기 상태로 접어든 프로세스 중 하나를 준비 상태로 전환함.

<img width="606" alt="image" src="https://github.com/user-attachments/assets/45260196-9e68-4292-b4a6-73f9da1bd95d">

(그림출처: 이것이 취업을 위한 컴퓨터 과학이다)

- 예를 들어, 공유 자원이 2개, 접근하려는 프로세스가 3개(P1, P2, P3)이고, P1, P2, P3의 순서로 임계 구역에 접근한다고 가정해보자. 공유 자원이 2개이므로 S는 2이고, 다음과 같은 순서로 실행될 것임.

<img width="610" alt="image" src="https://github.com/user-attachments/assets/a262880c-291d-43f5-8305-b642f78d382d">

(그림출처: 이것이 취업을 위한 컴퓨터 과학이다)