# 2024-12-22-TIL

# 동기화 기법 - 3️⃣

## 조건 변수와 모니터

- 모니터를 이해하려면 우선 조건 변수를 이해해야 함.
- 조건 변수란, 실행 순서 제어를 위한 동기화 도구로, 특정 조건 하에 프로세스를 실행/일시 중단함으로써 프로세스나 스레드의 실행 순서를 제어할 수 있음. 조건 변수에 대해 wait()와 signal() 함수를 호출할 수 있는데, **wait() 함수**는 호출한 프로세스 및 스레드의 상태를 대기 상태로 전환하는 함수이고, **signal()** 함수는 wait()로 일시 중지된 프로세스 및 스레드의 실행을 재개하는 함수
  - 아직 특정 프로세스가 실행될 조건이 되지 않았을 때는 wait()를 통해 실행을 중단한다.
  - 특정 프로세스가 실행될 조건이 충족되었을 대는 signal()을 통해 실행을 재개한다.

- 예를 들어, cv라는 조건 변수가 있고, 프로세스 P1의 실행 도중에 조건 변수 cv에 대해 wait() 함수를 호출했다고 가정해보자. 해당 프로세스는 다른 스레드가 cv.signal()을 호출하기 전까지 대기 상태로 접어들게 된다.

<img width="280" alt="image" src="https://github.com/user-attachments/assets/18830386-961e-41d9-84e9-ee3ff062fb51">

(그림출처: 이것이 취업을 위한 컴퓨터 과학이다.)

- **모니터(monitor)**는 공유 자원과 그 공유 자원을 다루는 함수(인터페이스)로 구성된 동기화 도구로, 상호 배제를 위한 동기화뿐만 아니라 실행 순서 제어를 위한 동기화까지 가능함.
- 프로세스 및 스레드는 공유 자원에 접근하기 위해 반드시 정해진 공유 자원 연산(인터페이스)을 통해 모니터 내로 진입해야 하고, 모니터 안에 진입하여 실행되는 프로세스 및 스레드는 항상 하나여야 함. 이미 모니터 내로 진입하여 실행 중인 프로세스 및 스레드가 있다면 큐에서 대기해야 함.

<img width="617" alt="image" src="https://github.com/user-attachments/assets/46fc19ba-16a1-49cc-8bfc-035a1cf34796">

(그림출처: 이것이 취업을 위한 컴퓨터 과학이다.)

- 예를 들어, 동시에 실행되는 프로세스 A, B 중 반드시 A가 먼저 실행되고, 다음으로 B가 실행되어야 한다는 조건을 가정해 보겠음
- 프로세스 B는 모니터 내에서 실행되기에 앞서 프로세스 A의 실행이 끝났는 지를 검사함. 프로세스 B가 모니터 내에서 실행되어도 괜찮은지를 검사하는 것. 프로세스 B가 프로세스 A보다 나중에 모니터 내로 진입했을 경우, '프로세스 A가 먼저 실행되고, 프로세스 B가 실행되어야 한다'는 조건이 충족된 셈이므로 프로세스 B는 모니터 내로 진입하여 실행됨

<img width="705" alt="image" src="https://github.com/user-attachments/assets/9c0e11d9-d04b-4d09-a32c-8bb756d7ce6f">

(그림출처: 이것이 취업을 위한 컴퓨터 과학이다.)

- 만약, 프로세스 B가 프로세스 A보다 먼저 모니터 내로 진입했을 경우, 이는 '프로세스 A가 먼저 실행되고 B가 실행되어야 한다'는 조건에 어긋난 경우임. 따라서, 이 경우에는 다음과 같이 특정 조건 변수(cv)에 대해 cv.wait()를 호출하여 프로세스 B를 대기 상태로 접어들게 할 수 있음.

<img width="671" alt="image" src="https://github.com/user-attachments/assets/b3913c72-4c31-40ad-854d-ad06efe7c019">

(그림출처: 이것이 취업을 위한 컴퓨터 과학이다.)

- 프로세스 B가 조건 변수 cv에 대한 wait()를 호출하여 대기 상태로 접어들었다면 프로세스 B가 대기하고 있는 사이 프로세스 A가 모니터 내로 진입하여 실행될 수 있고, 실행 이후 cv.signal()을 호출하여 대기 상태에 있던 프로세스 B를 모니터 안으로 재진입시킬 수 있음. 결국, 반드시 프로세스 A, 그 다음 프로세스 B의 순으로 실행되므로 실행 순서 제어를 위한 동기화가 이루어짐.

<img width="609" alt="image" src="https://github.com/user-attachments/assets/282a1043-6c8e-4419-9156-620b147408d2">

(그림출처: 이것이 취업을 위한 컴퓨터 과학이다.)

### 스레드 안전

- 각종 프로그래밍 언어의 공식 문서를 읽다 보면 다음과 같이 스레드 안전이라는 용어를 자주 접하게 될 것임.
- **스레드 안전(thread safety)**이란 멀티스레드 환경에서 어떤 변수나 함수, 객체에 동시 접근이 이루어져도 실행에 문제가 없는 상태를 의미. 레이스 컨디션이 발생했다면 이는 스레드 안전하지 않는 상황임. 반대로, 스레드 안전하다면, 이는 여러 스레드에 의해 호출되어도 레이스 컨디션이 발생하지 않는 것을 의미함.