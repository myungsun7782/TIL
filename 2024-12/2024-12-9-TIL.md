# 2024-12-9-TIL

# 시스템 콜과 이중모드

- 운영체제도 일종의 프로그램이기 때문에 프로그램이 실행되기 위해서는 반드시 메모리에 적재되어야 함.
- 다만, 사용자 프로그램과 달리 운영체제는 매우 특별한 프로그램이므로 메모리 내의 **커널 영역(Kernel Space)**이라는 공간에 따로 적재되어 실행됨.
- 다음과 같이 운영체제가 적재되는 커널 영역 외에 사용자 응용 프로그램이 적재되는 공간은 **사용자 영역(user space)**이라고 함.
- 우리가 주목해야할 점은 '운영체제의 기능을 제공받기 위해서는 커널 영역에 적재된 운영체제 코드를 실행해야 한다'는 점임.

<img width="293" alt="image" src="https://github.com/user-attachments/assets/fcfaebd6-8535-4e56-b099-e914cae0fab3">

(그림출처: 이것이 취업을 위한 컴퓨터 과학이다.)

- 일반적으로 웹 브라우저나 게임과 같은 (사용자) 응용 프로그램은 운영체제와 달리 CPU, 메모리와 같은 자원에 직접 접근하거나 조작할 수 없음. 특정 자원에 접근하거나 조작하는 운영체제 코드를 실행해야 함. 즉, 운영체제가 자신의 코드를 실행한 응용 프로그램의 자원 접근 및 조작을 대행하는 셈.

## 응용 프로그램은 어떻게 운영체제의 코드를 실행할까?

- 응용 프로그램은 **시스템 콜(system call)**을 호출하여 운영체제 코드를 실행할 수 있음.
- 시스템 콜을 운영체제의 서비스를 제공 받기 위한 수단(인터페이스)으로, 호출 가능한 함수의 형태를 가짐.
- 응용 프로그램이 운영체제로부터 어떤 기능을 제공받고자 한다면 다음과 같이 그 기능에 해당하는 시스템 콜을 호출하면 됨.

<img width="568" alt="image" src="https://github.com/user-attachments/assets/09080960-f422-447a-8425-e82b611f0e84">

(그림출처: 이것이 취업을 위한 컴퓨터 과학이다.)

- 운영체제에 따라 제공하는 시스템 콜의 종류와 개수는 다양함. 다음은 유닉스 계열의 운영체제에서 사용하는 대표적인 시스템 콜의 종류임.

<img width="815" alt="image" src="https://github.com/user-attachments/assets/3aa5722b-55b4-4e52-b85d-2e4f6def0049">

<img width="814" alt="image" src="https://github.com/user-attachments/assets/1d9e02f8-03bf-4a5b-8fa3-14e2839377e2">

(그림출처: 이것이 취업을 위한 컴퓨터 과학이다.)



## 컴퓨터 내부에서 시스템 콜이 호출되면 발생하는 작업들

<img width="808" alt="image" src="https://github.com/user-attachments/assets/59fbbbdd-4901-4f0e-bd0f-6b0e424d0bb3">

(그림출처: 이것이 취업을 위한 컴퓨터 과학이다.)

- 운영체제에는 인터럽트를 발생시키는 특정 명령어가 있음.
- 자원에 접근하는 입출력 명령어가 대표적이며, 이러한 명령어에 의해 발생하는 인터럽트를 **소프트웨어 인터럽트(software interrupt)**라고 함.
- 시스템 콜이 바로 이 소프트웨어 인터럽트의 일종임.
- 따라서, 사용자 영역을 실행하는 과정에서 시스템 콜이 호출되면 여느 인터럽트와 마찬가지로 CPU는 현재 수행 중인 작업을 백업하고, 커널 영역 내의 인터럽트를 처리하기 위한 코드 (시스템 콜을 구성하는 코드)를 실행한 뒤, 다시 사용자 영역의 코드 실행을 재개함.

<img width="539" alt="image" src="https://github.com/user-attachments/assets/7b28ac74-f963-4ee0-81e9-927328ab3e78">

(그림출처: 이것이 취업을 위한 컴퓨터 과학이다.)

- CPU는 명령어를 실행하는 과정에서 사용자 영역을 실행할 때의 모드와 커널 영역을 실항할 때의 모드를 구분하여 실행함.
- 이때, 사용자 영역에 적재된 코드를 실행할 때의 실행 모드를 **사용자 모드(user mode)**라 하고, 커널 영역에 적재된 코드를 실행할 때의 실행 모드를 **커널 모드(kernel mode)**라 함. 그리고 이렇게 2개의 모드로 구분하여 실행하는 것을 **이중 모드(dual mode)**라고 함.
- **사용자 모드**는 운영체제 서비스를 제공받을 수 없는 실행 모드로, 커널 영역의 코드를 실행할 수 없는 모드임. 사용자 모드로 실행중인 CPU는 입출력 명령어와 같이 자원에 접근하는 명령어를 만나도 이를 실행하지 않음. 덕분에 사용자 모드로 실행되는 명령어는 실수로라도 자원에 접근할 수 없음.
- 반면, **커널 모드**는 운영체제 서비스를 제공받을 수 있는 실행 모드로, 커널 영역의 코드를 실행할 수 있는 모드임. CPU가 커널 모드로 명령어를 실행하면 자원에 접근하는 명령어를 비롯한 모든 명령어를 실행할 수 있음.