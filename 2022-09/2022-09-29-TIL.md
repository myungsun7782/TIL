# 2022년 9월 29일(목)

---

### Today I Learned 

- [iOS-Swift] 클래스(Class)와 구조체(Struct) (3)

---

### 클래스의 메모리

**클래스 / 인스턴스(객체)의 메모리 구조**

```swift
class Person {
    var name: String
    var age: Int
    var hobby: String?  

    init(name: String, age: Int) {
        self.name = name 
        self.age = age 
        // self.hobby = "Sports" --> 생성자 내에서 기본 값 설정 가능 
    }
  
    func study() {
        print("\(name)가 공부합니다.")
    }
    func sleep() {
        print("\(name)가 잠을 잡니다.")
    }
}

var eddy = Person(name: "myungsun", age: 27) 
var loopy = Person(name: "gildong", age: 24)
```

- 데이터 영역에 Person 클래스 틀이 저장된다.
- 힙 영역에는 eddy, loopy 인스턴스의 실제 데이터 값이 저장된다.
  - 힙 영역에 있는 것들은 데이터 영역에 있는 Person 클래스 틀을 가리킨다.
- 스택 영역에는 eddy, loopy 인스턴스의 주소가 저장된다.
  - eddy, loopy 변수에는 각 인스턴스의 주소 값이 저장되어 있다.

### 구조체의 메모리

**구조체 / 인스턴스의 메모리 구조**

```swift
struct Bird {
    var name: String
    var weight: Double 

    func printName() {
        print("이름: \(name)")
    }

    func printWeight() {
        print("몸무게: \\(weight)")
    }
}

var aBird = Bird(name: "bia", weight: 5.0)
var bBird = Bird(name: "cin", weight: 5.2)
```

- 데이터 영역에 Bird Struct 틀이 저장된다.
- 클래스의 인스턴스와 다르게 스택 영역에 인스턴스의 값이 저장되고 스택 영역에 있는 변수는 데이터 영역의 Bird Struct 틀을 가리킨다.

### 클래스와 구조체의 차이 ⭐️⭐️⭐️

- ⭐️ **가장 큰 차이는 메모리 저장 방식의 차이** ⭐️

| 구분           | 구조체(struct)                                               | 클래스(class)                                                |
| -------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 타입           | Value Type(값 형식)                                          | Reference Type(참조 형식)                                    |
| 메모리 관련    | 값의 저장: Stack / 복사전달(메모리에서 자동 제거)            | 값의 저장: Heap / 주소 전달 (ARC로 관리) (주소 값은 스택에 저장) |
| let / var 선언 | 인스턴스 상수(let)로 선언시 저장 속성이 전부 상수로 선언됨   | 인스턴스 상수(let)로 선언하면 가르키는 인스턴스 고정 (주소 고정) (저장 속성은 각 let/var 선언에 따름) |
| 생성자 관련    | 맴버와이즈 이니셜라이저 (자동)제공                           | 편의 생성자 존재                                             |
| 메서드 + 속성  | 메서드 내에서 속성 변경 원칙적으로 불가능 (mutating 키워드로 가능) | 메서드 내에서 속성 변경 가능                                 |
| 소멸자         | 소멸자 없음                                                  | 소멸자 있음                                                  |
| 상속 가능 여부 | 상속 불가능                                                  | 상속 가능(클래스가 유일)                                     |

### 값 형식과 참조 형식 ⭐️⭐️⭐️

| 구분                  | 값 형식(구조체)                                              | 참조 형식(클래스)                                            |
| --------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 타입                  | Value Type                                                   | Reference Type                                               |
| 메모리 상의 저장 위치 | 필요시에 항상 메모리의 값이 복사되어 전달 값의 저장: Stack   | 필요 시에 항상 메모리의 주소를 전달 값의 저장: Heap(주소를 Stack에 저장) |
| 메모리 관리 방식      | 값이 들어있는 스택의 스코프가 종료되면 메모리에서 자동 제거  | RC(Reference Counting)을 통해 메모리를 관리 Swift에서 사용하는 ARC 모델 |
| 각 형식의 타입 예시   | Swift 기본 타입(Int, String, …), 튜플, 열거형, 컬렉션, 구조체 | 클래스, 클로저                                               |

### 클래스와 구조체를 사용하는 이유

- (의미있는) 데이터를 묶음으로 만들려는 것이다. (모델링) —> 상태 정보를 담는 바구니

1. 사용하려는 모델의 설계
   - Data Transfer Object(DTO): 관련 데이터를 한 곳에 담는 역할
   - Data Access Object(DAO): 데이터 처리(비즈니스 로직)
   - Helper Object: 유틸리티(도움주는 기능 / 날짜, 시간, 통화, 인코딩)
2. 애플이 미리 설계해 놓은 클래스 / 구조체들을 잘 사용하기 위함(프레임 워크)

### 언제 구조체 / 클래스를 사용해야 하는가?

- 구조체(struct)
  - 연관된 데이터들을 단순히 캡슐화(묶는)하는 것이 목적일 때
  - 캡슐화한(묶은) 데이터를 참조하는 것보다 복사해서 사용하는 것이 효율적일때
  - 구조체에 저장된 저장 속성들이 값 타입이며 참조하는 것보다 복사하는 것이 합당할 때
- 클래스(class)
  - 데이터에서 상속의 구조가 필요할 때
  - 해당 모델을 serialize해서 전송하거나 파일로 저장할 경우가 발생할 때

—> 필연적으로 클래스는 구조체보다 여러가지 면에서 속도가 느릴 수 밖에 없으므로 차이점을 명확하게 인지하고, 굳이 필요한 경우에만 클래스 사용