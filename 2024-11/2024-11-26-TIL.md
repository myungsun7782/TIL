# 2024-11-26-TIL

# 교착 상태

- 프로세스를 실행하기 위해서는 자원이 필요함. 하지만, 2개 이상의 프로세스가 각자 가지고 있는 자원을 무작정 기다린다면 더 이상 어떤 프로세스도 진행할 수 없는 교착 상태가 발생할 수 있음.
- **교착 상태(deadlock)**란 일어나지 않을 사건을 기다리며 프로세스의 진행이 멈춰 버리는 현상을 말함.
- 가령 프로세스 A는 자원 X를 점유한 채 프로세스 B가 점유하고 있는 자원 Y의 사용이 끝나기를 기다리고, 프로세스 B는 자원 Y를 점유한 채 프로세스 A가 점유한 자원 X의 사용이 끝나기를 기다린다고 가정해 보겠음. 결국 두 프로세스는 서로가 가진 자원을 기다리다가 프로세스를 실행하지 못할 수 있음.

<img width="329" alt="image" src="https://github.com/user-attachments/assets/93b62890-0d64-43a8-b2fe-b4f5cb67ae1f">

(그림출처: 이것이 취업을 위한 컴퓨터 과학이다.)

## 교착 상태의 발생 조건

- 교착 상태가 발생하는 상황에는 4가지 조건이 있음.
  - 상호 배제, 점유와 대기, 비선점, 원형 대기
- 이 중 하나라도 만족하지 않는다면 교착 상태는 발생하지 않고, 4개의 조건이 모두 만족할 때 교착 상태가 발생할 **가능성이 생긴다**고 보면 됨

### 1. 상호 배제

- 교착 상태가 발생하는 근복적인 원인은 한 번에 하나의 프로세스만 해당 자원을 이용 가능했기 때문임. 즉, 한 프로세스가 사용하는 자원을 다른 프로세스가 사용할 수 없는 **상호 배제**의 상황에서 교착 상태가 발생할 수 있음.

### 2. 점유와 대기

- 한 프로세스가 어떤 자원을 할당 받은 상태(점유)에서 다른 자원 할당받기를 기다린다면 (대기)교착 상태가 발생할 수 있음. 즉, **점유와 대기**의 상황임.

### 3. 비선점

- 비선점 또한 교착 상태 발생의 근복적 문제라고 할 수 있음. 자원이 비선점되었다는 말은 해당 자원을 이용하는 프로세스의 작업이 끝나야만 비로소 자원을 이용할 수 있다는 것을 의미함. 즉, 어떤 프로세스도 다른 프로세스의 자원을 강제로 빼앗지 못하는 경우 교착 상태가 발생할 수 있음.

### 4. 원형 대기

- 프로세스와 프로세스가 요청한 자원이 원의 형태를 이루는 경우임. 다음처럼 각각의 프로세스가 서로 점유한 자원을 할당받기 위해 원의 형태로 대기할 경우 교착 상태가 발생할 수 있음.

<img width="649" alt="image" src="https://github.com/user-attachments/assets/baec79d2-6792-4da8-a05d-b9662c1ca6ac">

(그림출처: 이것이 취업을 위한 컴퓨터과학이다.)

## 교착 상태의 해결방법

- 운영체제는 애초에 교착 상태의 발생 조건에 부합하지 않도록 자원을 분배하는 방식으로 교착 상태를 **예방**할 수 있고, 교착 상태가 발생하지 않을 정도로 조금씩 자원을 할당하다가 교착 상태의 위험이 있을 때 자원을 할당하지 않는 방식으로 교착 상태를 **회피**할 수도 있음. 또 자원을 제약 없이 할당하다가 교착 상태를 **검출한 후 회복**할 수도 있음.

### 1. 교착 상태 예방

- 교착 상태를 예방하는 방법은 앞서 설명한 **교착 상태를 발생시키는 4가지 필요 조건 중 하나를 충족하지 못하게 하는 방법**임.
- 프로세스에 자원을 할당할 때 상호 배제, 점유와 대기, 비선점, 원형 대기 중 하나라도 만족하지 않으면 교착 상태가 발생하지 않기 때문.
- 가령, 한 프로세스에 필요한 자원들을 몰아 주고, 그 다음에 다른 프로세스에 필요한 자원을 몰아주면 점유와 대기 조건을 만족하지 않으므로 교착 상태가 발생하지 않음. 또한, 할당 가능한 모든 자원에 번호를 매기고 오름차순으로 할당하는 경우, 원형 대기 조건을 만족하지 않으므로 교착 상태가 발생하지 않음.
- 자원 X에 0, 자원 Y에 1, 자원 Z에 2라는 번호를 매기고 프로세스들로 하여금 반드시 오름차순으로 자원을 할당받도록 제한하면 원형 대기 조건을 만족하지 않음.

<img width="612" alt="image" src="https://github.com/user-attachments/assets/0e650e29-5fe5-40dd-b76e-50addecf9ea6">

(그림출처: 이것이 취업을 위한 컴퓨터 과학이다.)

### 2. 교착 상태 회피

- 교착 상태 회피는 교착 상태가 발생하지 않을 정도로만 조심하면서 자원을 할당하는 방법임. 교착 상태 회피는 기본적으로 교착 상태를 **한정된 자원의 무분별한 할당으로 인해 발생하는 문제**로 간주함. 프로세스에 할당할 수 있는 자원이 충분한 상황에서 프로세스들이 한두 개 적은 자원만을 요구한다면 교착 상태는 발생하지 않겠지만, 자원이 한정된 상황에서 모든 프로세스들이 한 번에 많은 자원을 요구한다면 교착 상태가 발생할 위험이 증가하게 됨.

### 3. 교착 상태 검출 후 회복

- 교착 상태 예방과 회피가 교착 상태 발생을 막기 위한 사전 조치였다면, 교착 상태의 발생을 인정하고 처리하는 사후 조치에 해당함. 이 경우, 운영체제는 프로세스가 자원을 요구할 때마다 그때 그때 자원을 할당하고 주기적으로 교착 상태의 발생 여부를 검사함.
- 그러다 교착 상태가 검출되면 프로세스를 자원 선점을 통해 회복시키거나, 교착 상태에 놓인 프로세스를 강제 종료함으로써 회복시킬 수 있음. 자원 선점을 통한 회복이란 교착 상태가 해결될 때까지 다른 프로세스로부터 강제로 자원을 빼앗아 한 프로세스에 몰아서 할당하는 것을 의미함.

