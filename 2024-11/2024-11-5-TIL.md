# 2024-11-5-TIL

안녕하세요.

오늘은 컴퓨터 구조에서 파이프라이닝을 통한 명령어 병렬 처리에 대해 알아보도록 하겠습니다,

# 파이프라이닝을 통한 명령어 병렬 처리

- **명령어 병렬 처리 기법(Instruction-Level Parallelism)**은 여러 명령어를 동시에 처리하여 CPU를 한시도 쉬지 않고 작동시킴으로써 CPU의 성능을 높이는 기법을 말함.
- 현대 CPU의 명령어 처리에서 절대 빠질 수 없는 핵심 기술이라고 할 수 있음.
- 명령어 파이프라이닝을 이해하려면 우선 하나의 명령어가 처리되는 과정을 비슷한 시간 간격으로 나누어 보야야 함. 일반적으로 다음과 같은 간격으로 나눌 수 있음
  1. 명령어 인출(Instruction Fetch)
  2. 명령어 해석(Instruction Decode)
  3. 명령어 실행(Execute Instruction)
  4. 결과 저장(Write Back)

- 여기서 중요한 점은 같은 단계가 겹치지만 않는다면 CPU가 각각의 단계를 동시에 실행할 수 있다. CPU는 하나의 명령어가 인출하는 동안 다른 명령어를 실행할 수 있고, 하나의 명령어가 실행되는 동안 연산의 결과를 저장할 수 있음.
- 공장의 생산 라인과 같이 명령어들을 **명령어 파이프라인(Instruction pipeline)**에 넣고, 동시에 처리하는 기법을 **명령어 파이프라이닝(Instruction pipelining)**이라고 함.
- 파이프라이닝 성능의 차이를 보이는 대표적인 명령어 집합 유형
  - **CISC(Complex Instruction Set Computer)**
    - CISC 기반의 CPU => Intel x86, x86-64 CPU
    - 이름 그대로 다채로운 기능을 지원하는 복잡한 명령어들로 구성된 명령어 집합
    - 적은 수의 명령어로도 프로그램을 실행할 수 있음
    - 다만, 활용하는 명령어가 워낙 복잡하고 다양한 기능을 제공하는 탓에 명령어의 크기 및 실행되기까지의 시간이 일정하지 않고, 하나의 명령어 실행에 여러 클럭 주기가 필요
    - RISC에 비해 명령어 수행 시간이 길고, 들쑥날쑥하기 때문에 파이프라이닝에 비효율적일 수 있음
  - **RISC(Reduced Instruction Set Computer)**
    - RISC 기반의 CPU => Apple의 M1 CPU
    - CISC에 비해 활용 가능한 명령어의 종류가 작음.
    - CISC와는 달리 짧고, 규격화된 명령어, 되도록이면 1클럭 내외로 실행되는 명령어를 지향
    - 같은 프로그램이라 하더라도 RISC에는 CISC보다 많은 명령어가 필요
    - 파이프라이닝에 최적화
- 파이프라이닝이 CPU 성능 향상에 실패하는 경우
  - 파이프라이닝이 실패하여 성능 향상이 이루어지지 않는 상황은 **파이프라인 위험**이라고 부르며, **데이터 위험**과 **제어 위험**, **구조적 위험**으로 구분할 수 있음.
    - 데이터 위험
      - 명령어 간의 데이터 의존성에 의해 발생
      - 어떤 명령어들은 동시에 처리할 수 없고, 이전 명령어를 끝까지 실행해야만 비로소 실행할 수 있음
      - 예를 들어, 다음의 두 명령어 중 명령어 2는 명령어 1에 의존적
      - 명령어 1의 저장까지 끝낸 뒤에야 비로소 명령어 2를 인출할 수 있기 때문
    - 제어 위험
      - 프로그램 카운터의 갑작스러운 변화에 의해 발생합니다.
      - 프로그램 카운터는 기본적으로 1씩 증가하며, '현재 실행 중인 명령어의 다음 주소'로 갱신
      - 하지만, JUMP, CONDITIONAL JUMP, 인터럽트 등으로 인해 프로그램 실행의 흐름이 바뀌어 명령어가 실행되면서 프로그램 카운터 값에 갑작스러운 변화가 생기면 미리 인출하거나 해석 중인 명령어들은 아무 쓸모가 없어지게 됨.
    - 구조적 위험
      - 명령어를 겹쳐 실행하는 과정에서 서로 다른 명령어가 동시에 ALU, 레지스터 등 같은 CPU 부품을 사용하려고 할 때 발생.
      - 자원 위험이라고도 부름

<br/>

<br/>

오늘 공부한 내용은 여기까지 입니다.

읽어주셔서 감사합니다.