# 2024-11-19-TIL

안녕하세요.

오늘은 프로세스 간 통신에 대해 알아보도록 하겠습니다.

# 프로세스 간 통신

- 프로세스는 기본적으로 자원을 공유하지 않지만, 프로세스 간에도 자원을 공유하고 데이터를 주고 받을 수 있는 방법이 있습니다. 이를 프로세스 간 통신(이하 IPC)(Inter-Process Communication)이라고 부름.
- 프로세스 간 통신이 이루어지는 방식에는 크게 2가지 유형이 있음
  - 공유 메모리
    - 말 그대로 데이터를 주고받는 프로세스가 공통적으로 사용할 메모리 영역을 두는 방식
  - 메시지 전달
    - 프로세스 간에 주고받을 데이터를 메시지의 형태로 주고받는 방식을 말함.

<img width="485" alt="image" src="https://github.com/user-attachments/assets/8c4ca543-688d-491b-8038-8662bba672b3">

(그림 출처: 이것이 취업을 위한 컴퓨터 과학이다.)

## 공유 메모리

- 프로세스 간에 공유하는 메모리 영역을 토대로 데이터를 주고받는 통신 방식
- 앞서 설명했던 프로세스는 기본적으로 자원을 공유하지 않으므로 특정 프로세스가 다른 프로세스의 메모리 공간을 임의로 수정할 수 없음. 
- 하지만, 공유 메모리라는 특별한 메모리 공간을 할당하면 프로세스가 해당 메모리 공간을 공유하여 읽고 쓸 수 있음. 예를 들어, 프로세스 A는 공유 메모리 공간에 데이터를 쓰고, 프로세스 B는 해당 메모리 공간을 읽는다고 가정해보자. 프로세스 A 입장에서는 자신에게 할당된(공유된) 메모리 공간에 데이터를 썼을 뿐이고, 프로세스 B의 입장에서는 자신에게 할당된(공유된) 메모리 공간의 데이터를 읽었을 뿐이지만, 결과적으로는 프로세스 A가 프로세스 B에게 데이터를 공유한 것과 같은 셈임.

<img width="270" alt="image" src="https://github.com/user-attachments/assets/f5d5c66a-446c-40dc-9121-4d5bc52b67ed">

(그림 출처: 이것이 취업을 위한 컴퓨터 과학이다.)

- 공유 메모리 기반 IPC는 프로세스가 공유하는 메모리 영역을 확보하는 시스템 콜을 기반으로 수행될 수도 있고, 간단하게 프로세스가 공유하는 변수나 파일을 활용할 수도 있음.
- 공유 메모리 기반 IPC의 가장 중요한 특징은 각 프로세스가 마치 자신의 메모리 영역을 읽고 쓰는 것처럼 통신한다는 점이다.
- 또한, 프로세스가 데이터를 주고받는 과정에 커널의 개입이 거의 없다는 점도 중요한 특징임.
- 다시 말해, 프로세스가 주고받는 데이터는 커널 영역을 거치지 않는 경우가 많음. 또 공유 메모리 기반 IPC는 각 프로세스가 각자의 메모리 영역(사용자 영역)을 읽고 쓰는 것뿐이므로 뒤에서 설명할 메시지 전달 방식보다 통신 속도가 빠름.
- 대신, 각각의 프로세스가 서로의 공유 메모리 영역을 동시에 읽고 쓸 경우, 데이터의 일관성이 훼손될 수 있음. 이를 **레이스 컨디션**이라고 함.

## 메시지 전달

- 프로세스 간에 주고받을 데이터가 커널을 거쳐 송수신되는 통신 방식.

- 각각의 프로세스가 자신의 메모리 영역(사용자 영역)을 읽고 쓰는 것으로 통신이 가능한 공유 메모리 기반 IPC와 달리, 메시지 전달 기반 IPC는 메시지를 보내는 수단과 받는 수단이 명확하게 구분되어 있음.

  - 일례로, 메시지를 보내는 시스템 콜인 send()라는 시스템 콜과 메시지를 받는 시스템 콜인 recv()라는 시스템 콜이 정해져 있고, 각 프로세스는 두 시스템 콜을 호출하며 메시지를 송수신할 수 있음.
  - 데이터를 주고받는 프로세스의 입장에서 메시지 전달 기반 IPC는 공유 메모리 기반 IPC보다 커널의 도움을 적극적으로 받을 수 있으므로 레이스 컨디션, 동기화 등의 문제를 고려하는 일이 상대적으로 적음. 다만, 주고 받는 데이터가 커널을 통해 송수신되므로 공유 메모리 기반 IPC보다 통신 속도는 느림.
  - 메시지 던달 기반 IPC를 위한 대표적인 수단으로는 파이프, 시그널, 소켓, 원격 프로시저 호출(RPC)등이 있음.
  - 먼저 파이프란 단방향 프로세스 간의 통신 도구를 말함. 아래 그림과 같이 프로세스 A가 파이프의 한 쪽 방향에서 데이터를 쓰면 프로세스 B는 파이프 반대쪽으로 그 데이터를 읽을 수 있음. 파이프를 물길처럼 데이터가 흐를 수 있는 공간이라고 생각하면 쉬움. 파이프에 삽입된 데이터의 관점에서 보면 먼저 파이프에 삽입된 데이터가 먼저 읽히게 되는 것. 단방향으로만 일고 쓸 수 있는 파이프로 양뱡향 통신을 수행할 경우, 읽기용 파이프와 쓰기용 파이프 2개를 이용해 양방향으로 통신하는 경우가 많음.

  <img width="506" alt="image" src="https://github.com/user-attachments/assets/7a9c6252-3f31-4c97-9aab-fd0c38ec5f22">

<img width="553" alt="image" src="https://github.com/user-attachments/assets/a1b5611b-b50f-4266-ac7b-540e40833e57">

(그림출처: 이것이 취업을 위한 컴퓨터 과학이다.)

- 또한 시그널은 프로세스에게 특정 이벤트가 발생했음을 알리는 비동기적인 신호.
- 사실 시그널 자체는 IPC만을 위해 존재하는 개념이 아니므로 '시그널을 적절히 활용해 IPC를 수행할 수 있다'는 정도로 이해하면 됨
- 시그널을 발생시키는 이벤트의 종류는 다양함. 대부분은 인터럽트와 관련된 이벤트이지만, 사용자가 직접 정의할 수 있는 시그널도 있음.

[리눅스 운영체제의 대표적인 시그널 예시]

<img width="602" alt="image" src="https://github.com/user-attachments/assets/63a47cd5-0ac6-4ea5-a96b-fbf98b6b2701">

(그림 출처: 이것이 취업을 위한 컴퓨터 과학이다.)

- 프로세스는 시그널이 발생하면 여느 인터럽트 처리 과정과 유사하게 하던 일을 잠시 중단하고, 시그널 처리를 위한 시그널 핸들러를 실행한 뒤 실행을 재개함.
- 이 때 프로세스는 직접 특정 시그널을 발생시킬 수 있고, 직접 일부 시그널 핸들러를 (재)정의 할 수 있음.
- 시그널을 이용하는 방법은 앞선 IPC 기법들과 다르게 직접적으로 메시지를 주고받지는 않지만, 비동기적으로 원하는 동작을 수행할 수 있는 좋은 수단임.

<img width="444" alt="image" src="https://github.com/user-attachments/assets/c6f93f91-913a-47a3-bcaa-c5947f61aa33">

<img width="558" alt="image" src="https://github.com/user-attachments/assets/7f7d0f65-2fac-46b9-bc3e-9521e7c80c80">

(그림 출처: 이것이 취업을 위한 컴퓨터 과학이다.)

<br/>

<br/>

오늘 공부한 내용은 여기까지 입니다.

읽어주셔서 감사합니다.